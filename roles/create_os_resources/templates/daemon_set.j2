        {% for hypervisor in openstack_hypervisors %}
        mons_slave_port_{{ loop.index }}:
                type: OS::Neutron::Port
                properties:
                        name: mons-slave-port-{{ loop.index }}
                        network: { get_resource: mons_network }
                        security_groups:
                                - { get_resource: mons_security_group }

        {% if assign_floating_ip_daemon_set %}
        mons_slave_floating_ip_{{ loop.index }}:
                type: OS::Neutron::FloatingIP
                properties:
                        floating_network: { get_param: public_network }
                        port_id: { get_resource: mons_slave_port_{{ loop.index }} }

        {% endif %}
        mons_slave_instance_{{ loop.index }}:
                type: OS::Nova::Server
                properties:
                        availability_zone: list_join: [":", [ { get_param: availability_zone }, {{ hypervisor.name.split('.')[0]  }}]]
                        flavor: { get_resource: mons_slave_flavor }
                        image: { get_param: slave_image_id }
                        key_name: { get_resource: mons_key_pair }
                        networks:
                                - port: { get_resource: mons_slave_port_{{ loop.index }} }
                        security_groups:
                                - { get_resource: mons_security_group }
                        name:
                                list_join: ["-", [ { get_param: slave_instance_name }, {{ hypervisor.name.split('.')[0]  }}]]
                        metadata:
                                - hostname:
                                        list_join: ["-", [ { get_param: slave_instance_name }, {{ hypervisor.name.split('.')[0]  }}]]

        {% endfor %}
